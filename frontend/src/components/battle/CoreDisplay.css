/* frontend/src/components/battle/CoreDisplay.css */

.core-display {
  display: flex;
  flex-direction: column;
  align-items: center;
  min-width: 200px;
}

/* Enemy has nameplate on top, sprite below */
.core-display.enemy {
  flex-direction: column-reverse;
}

.core-display.knocked-out {
  opacity: 0.5;
  filter: grayscale(50%);
}

/* 3D Stage - Creates perspective for the standing sprite */
.core-3d-stage {
  perspective: 600px;
  perspective-origin: center bottom;
  position: relative;
  display: flex;
  flex-direction: column;
  align-items: center;
}

/* Standing Sprite - The core character standing upright */
.core-sprite-standing {
  position: relative;
  width: 140px;
  height: 140px;
  transform-style: preserve-3d;
  transform: rotateX(8deg);
  transition: transform 0.15s ease-out;
  z-index: 2;
  cursor: pointer;
}

/* Idle bob animation only when not being interacted with */
.core-sprite-standing:not(.hovered) {
  animation: idleBob 3s ease-in-out infinite;
}

.core-sprite-standing.hovered {
  animation: none;
  filter: brightness(1.1);
}

/* Idle breathing/bobbing animation */
@keyframes idleBob {
  0%, 100% { transform: rotateX(8deg) translateY(0); }
  50% { transform: rotateX(8deg) translateY(-4px); }
}

@keyframes shadowBreathe {
  0%, 100% { transform: translateX(-50%) scale(1); opacity: 1; }
  50% { transform: translateX(-50%) scale(0.92); opacity: 0.85; }
}

/* Ground shadow - Ellipse on the ground plane */
.core-ground-shadow {
  position: absolute;
  bottom: -20px;
  left: 50%;
  transform: translateX(-50%);
  width: 100px;
  height: 24px;
  background: radial-gradient(ellipse at center, rgba(0, 0, 0, 0.5) 0%, rgba(0, 0, 0, 0.2) 50%, transparent 70%);
  border-radius: 50%;
  filter: blur(3px);
  z-index: 1;
  animation: shadowBreathe 3s ease-in-out infinite;
  transition: transform 0.15s ease-out, opacity 0.15s ease-out;
}

/* Shadow responds to hover */
.core-sprite-standing.hovered ~ .core-ground-shadow {
  animation: none;
  transform: translateX(-50%) scale(1.1);
  opacity: 0.7;
}

.core-display.enemy .core-ground-shadow {
  background: radial-gradient(ellipse at center, rgba(100, 20, 20, 0.5) 0%, rgba(0, 0, 0, 0.2) 50%, transparent 70%);
}

.core-display .core-sprite {
  width: 100%;
  height: 100%;
  object-fit: contain;
  filter: drop-shadow(2px 4px 6px rgba(0, 0, 0, 0.4));
}

.core-display.player .core-sprite {
  filter: drop-shadow(2px 4px 6px rgba(0, 150, 150, 0.3));
}

.core-display.enemy .core-sprite {
  filter: drop-shadow(2px 4px 6px rgba(150, 50, 50, 0.3));
}

.core-display .core-sprite-placeholder {
  width: 100%;
  height: 100%;
  display: flex;
  align-items: center;
  justify-content: center;
  background: linear-gradient(135deg, #1a1a2e, #16213e);
  border-radius: 50%;
  font-size: 3rem;
  color: #00ffff;
  font-family: 'Courier New', monospace;
  filter: drop-shadow(2px 4px 6px rgba(0, 0, 0, 0.4));
}

.core-display.enemy .core-sprite-placeholder {
  color: #ff4444;
}

.core-display .ko-overlay {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  padding: 0.5rem 1rem;
  background: rgba(0, 0, 0, 0.8);
  border: 2px solid #ff4444;
  border-radius: 4px;
  color: #ff4444;
  font-size: 1.5rem;
  font-weight: bold;
  font-family: 'Courier New', monospace;
  text-shadow: 0 0 10px #ff4444;
}

/* Info Nameplate - Floating below the sprite (or above for enemy) */
/* All styles scoped to .core-display to avoid conflicts with Garage/Scrapyard */
.core-display .core-info {
  width: 180px;
  margin-top: 0.75rem;
  padding: 0.5rem 0.75rem;
  background: rgba(0, 20, 40, 0.9);
  border: 2px solid #00ffff;
  border-radius: 6px;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
}

.core-display.enemy .core-info {
  border-color: #ff4444;
  margin-top: 0;
  margin-bottom: 0.75rem;
}

.core-display.active .core-info {
  box-shadow: 0 0 15px rgba(0, 255, 255, 0.4), 0 4px 12px rgba(0, 0, 0, 0.4);
}

.core-display.enemy.active .core-info {
  box-shadow: 0 0 15px rgba(255, 68, 68, 0.4), 0 4px 12px rgba(0, 0, 0, 0.4);
}

.core-display .core-name-row {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 0.4rem;
}

.core-display .core-name {
  color: #ffffff;
  font-weight: bold;
  font-size: 0.9rem;
}

.core-display .core-rarity {
  font-size: 0.7rem;
  padding: 2px 6px;
  border-radius: 4px;
}

.core-display .rarity-common { background: #808080; color: #fff; }
.core-display .rarity-uncommon { background: #2e8b57; color: #fff; }
.core-display .rarity-rare { background: #4169e1; color: #fff; }
.core-display .rarity-legendary { background: #9932cc; color: #fff; }
.core-display .rarity-mythic { background: linear-gradient(45deg, #ff6b6b, #ffd93d, #6bcf7f, #4dabf7); color: #000; }

.core-display .hp-bar-container {
  position: relative;
  width: 100%;
}

.core-display .hp-bar-background {
  height: 16px;
  background: #1a1a2e;
  border-radius: 3px;
  overflow: hidden;
  border: 1px solid #333;
}

.core-display .hp-bar-fill {
  height: 100%;
  transition: width 0.3s ease-out;
}

.core-display .hp-bar-fill.hp-high { background: linear-gradient(90deg, #00ff00, #7fff00); }
.core-display .hp-bar-fill.hp-medium { background: linear-gradient(90deg, #ffff00, #ffa500); }
.core-display .hp-bar-fill.hp-low { background: linear-gradient(90deg, #ff4500, #ff0000); }

.core-display .hp-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  color: #fff;
  font-size: 0.65rem;
  font-weight: bold;
  text-shadow: 1px 1px 2px #000;
}

.core-display .core-type-badge {
  margin-top: 0.4rem;
  padding: 2px 6px;
  background: rgba(0, 255, 255, 0.2);
  border: 1px solid #00ffff;
  border-radius: 3px;
  font-size: 0.6rem;
  color: #00ffff;
  text-align: center;
}

.core-display.enemy .core-type-badge {
  background: rgba(255, 68, 68, 0.2);
  border-color: #ff4444;
  color: #ff4444;
}

/* Hit Animation - Shake (applied to standing sprite) */
.core-sprite-standing.anim-hit {
  animation: shake 0.4s ease-in-out;
}

.core-ground-shadow.anim-hit {
  animation: shadowShake 0.4s ease-in-out;
}

@keyframes shake {
  0%, 100% { transform: rotateX(8deg) translateX(0); }
  10% { transform: rotateX(8deg) translateX(-10px) rotateZ(-2deg); }
  20% { transform: rotateX(8deg) translateX(10px) rotateZ(2deg); }
  30% { transform: rotateX(8deg) translateX(-8px) rotateZ(-1deg); }
  40% { transform: rotateX(8deg) translateX(8px) rotateZ(1deg); }
  50% { transform: rotateX(8deg) translateX(-5px); }
  60% { transform: rotateX(8deg) translateX(5px); }
  70% { transform: rotateX(8deg) translateX(-3px); }
  80% { transform: rotateX(8deg) translateX(3px); }
  90% { transform: rotateX(8deg) translateX(-1px); }
}

@keyframes shadowShake {
  0%, 100% { transform: translateX(-50%); }
  10% { transform: translateX(calc(-50% - 10px)) scaleX(1.1); }
  20% { transform: translateX(calc(-50% + 10px)) scaleX(1.1); }
  30% { transform: translateX(calc(-50% - 8px)); }
  40% { transform: translateX(calc(-50% + 8px)); }
  50% { transform: translateX(calc(-50% - 5px)); }
  60% { transform: translateX(calc(-50% + 5px)); }
  70% { transform: translateX(calc(-50% - 3px)); }
  80% { transform: translateX(calc(-50% + 3px)); }
  90% { transform: translateX(calc(-50% - 1px)); }
}

/* Critical Hit Animation - Bigger shake with flash */
.core-sprite-standing.anim-crit {
  animation: critShake 0.5s ease-in-out;
}

.core-ground-shadow.anim-crit {
  animation: shadowCritShake 0.5s ease-in-out;
}

@keyframes critShake {
  0% { transform: rotateX(8deg); filter: brightness(1); }
  10% { transform: rotateX(8deg) translateX(-14px) rotateZ(-3deg); filter: brightness(1.6); }
  20% { transform: rotateX(8deg) translateX(14px) rotateZ(3deg); filter: brightness(1); }
  30% { transform: rotateX(8deg) translateX(-12px) rotateZ(-2deg); filter: brightness(1.4); }
  40% { transform: rotateX(8deg) translateX(12px) rotateZ(2deg); filter: brightness(1); }
  50% { transform: rotateX(8deg) translateX(-8px) rotateZ(-1deg); }
  60% { transform: rotateX(8deg) translateX(8px) rotateZ(1deg); }
  70% { transform: rotateX(8deg) translateX(-4px); }
  80% { transform: rotateX(8deg) translateX(4px); }
  90% { transform: rotateX(8deg) translateX(-2px); }
  100% { transform: rotateX(8deg); filter: brightness(1); }
}

@keyframes shadowCritShake {
  0%, 100% { transform: translateX(-50%) scale(1); }
  10% { transform: translateX(calc(-50% - 14px)) scale(1.3); }
  20% { transform: translateX(calc(-50% + 14px)) scale(1.2); }
  30% { transform: translateX(calc(-50% - 12px)) scale(1.2); }
  40% { transform: translateX(calc(-50% + 12px)) scale(1.1); }
  50% { transform: translateX(calc(-50% - 8px)) scale(1.1); }
  60% { transform: translateX(calc(-50% + 8px)) scale(1); }
}

/* Miss Animation - Dodge to the side */
.core-sprite-standing.anim-miss-left {
  animation: dodgeLeft 0.4s ease-out;
}

.core-sprite-standing.anim-miss-right {
  animation: dodgeRight 0.4s ease-out;
}

.core-ground-shadow.anim-miss-left {
  animation: shadowDodgeLeft 0.4s ease-out;
}

.core-ground-shadow.anim-miss-right {
  animation: shadowDodgeRight 0.4s ease-out;
}

@keyframes dodgeLeft {
  0% { transform: rotateX(8deg) translateX(0); }
  30% { transform: rotateX(8deg) translateX(-30px) rotateZ(-5deg) rotateY(-8deg); }
  50% { transform: rotateX(8deg) translateX(-30px) rotateZ(-5deg) rotateY(-8deg); }
  100% { transform: rotateX(8deg) translateX(0) rotateZ(0) rotateY(0); }
}

@keyframes dodgeRight {
  0% { transform: rotateX(8deg) translateX(0); }
  30% { transform: rotateX(8deg) translateX(30px) rotateZ(5deg) rotateY(8deg); }
  50% { transform: rotateX(8deg) translateX(30px) rotateZ(5deg) rotateY(8deg); }
  100% { transform: rotateX(8deg) translateX(0) rotateZ(0) rotateY(0); }
}

@keyframes shadowDodgeLeft {
  0% { transform: translateX(-50%); }
  30% { transform: translateX(calc(-50% - 30px)) scaleX(0.7); }
  50% { transform: translateX(calc(-50% - 30px)) scaleX(0.7); }
  100% { transform: translateX(-50%) scaleX(1); }
}

@keyframes shadowDodgeRight {
  0% { transform: translateX(-50%); }
  30% { transform: translateX(calc(-50% + 30px)) scaleX(0.7); }
  50% { transform: translateX(calc(-50% + 30px)) scaleX(0.7); }
  100% { transform: translateX(-50%) scaleX(1); }
}

/* Attack Animation - Lunge forward */
.core-sprite-standing.anim-attack {
  animation: attackLunge 0.3s ease-out;
}

.core-display.enemy .core-sprite-standing.anim-attack {
  animation: attackLungeEnemy 0.3s ease-out;
}

@keyframes attackLunge {
  0% { transform: rotateX(8deg); }
  50% { transform: rotateX(4deg) translateX(20px) scale(1.08); }
  100% { transform: rotateX(8deg) scale(1); }
}

@keyframes attackLungeEnemy {
  0% { transform: rotateX(8deg); }
  50% { transform: rotateX(4deg) translateX(-20px) scale(1.08); }
  100% { transform: rotateX(8deg) scale(1); }
}
